source-file "$DOT_SOURCE"/tmux/unused_mappings.conf

set -g @plugin 'tmux-plugins/tpm'                      # Tmux Plugin Manager
set -g @plugin 'tmux-plugins/tmux-sensible'            # Sensible configurations

# Color Scheme
set -g @plugin 'egel/tmux-gruvbox'
set -g @tmux-gruvbox 'dark256'
set -g @tmux-gruvbox-statusbar-alpha 'true'

set -g @plugin 'nyuyuyu/tmux-pet'                      # Store snippets within tmux
set -g @plugin 'tmux-plugins/tmux-battery'             # Get the battery status to show in status bar
set -g @plugin 'tmux-plugins/tmux-cpu'                 # CPU/RAM Status
set -g @plugin 'tmux-plugins/tmux-yank'                # Copy selected text to system clipboard using y
set -g @plugin 'MunifTanjim/tmux-mode-indicator'       # Show current mode in tmux status line

# =====================================
# ======= TMUX KEY BINDINGS ===========
# =====================================

# renumber windows sequentially after closing any of them
set -g renumber-windows on

# remap prefix from 'C-b' to 'C-a'
set-option -g prefix C-a
bind-key C-a send-prefix

bind -N "Previous window" -n M-[ previous-window
bind -N "Next window" -n M-] next-window

## Join windows: <prefix> s, <prefix> j
bind -N "Join pane from another window" j command-prompt -p "join pane from:"  "join-pane -s '%%'"
bind -N "Send pane to another window" s command-prompt -p "send pane to:"  "join-pane -t '%%'"

# Break out the current pane to a window
bind -N "Break pane into new window" b break-pane -d

bind -N "New window in current path" C-c new-window -c "#{pane_current_path}"
bind -N "Kill pane" C-w kill-pane

bind -N "Maximize/zoom pane toggle" -n M-z resize-pane -Z
bind -N "Clear pane and history" -n M-x send-keys -R \; send-keys C-l \; clear-history

# Resizing Splits
bind -N "Resize pane left" H resize-pane -L 1 \; switch-client -T prefix
bind -N "Resize pane down" J resize-pane -D 1 \; switch-client -T prefix
bind -N "Resize pane up" K resize-pane -U 1 \; switch-client -T prefix
bind -N "Resize pane right" L resize-pane -R 1 \; switch-client -T prefix

bind -N "Navigate to left pane" -n M-h select-pane -L
bind -N "Navigate to pane below" -n M-j select-pane -D
bind -N "Navigate to pane above" -n M-k select-pane -U
bind -N "Navigate to right pane" -n M-l select-pane -R

bind-key -N "Select window 1" -n M-1 select-window -t :1
bind-key -N "Select window 2" -n M-2 select-window -t :2
bind-key -N "Select window 3" -n M-3 select-window -t :3
bind-key -N "Select window 4" -n M-4 select-window -t :4
bind-key -N "Select window 5" -n M-5 select-window -t :5
bind-key -N "Select window 6" -n M-6 select-window -t :6
bind-key -N "Select window 7" -n M-7 select-window -t :7
bind-key -N "Select window 8" -n M-8 select-window -t :8
bind-key -N "Select window 9" -n M-9 select-window -t :9
bind-key -N "Select window 10" -n M-0 select-window -t :10

# Rename session and window
bind -N "Rename window" C-n command-prompt -I "#{window_name}" "rename-window '%%'"

bind -N "Rename session" R command-prompt -I "#{session_name}" "rename-session '%%'"

# split panes using \ and -
bind -N "Split pane horizontally" \\ split-window -h -c "#{pane_current_path}"
bind -N "Split pane horizontally" -n M-\\ split-window -h -c "#{pane_current_path}"

bind -N "Split pane vertically" - split-window -v -c "#{pane_current_path}"
bind -N "Split pane vertically" -n M-- split-window -v -c "#{pane_current_path}"

# reload config file
bind -N "Reload tmux config" r source-file ~/.config/tmux/tmux.conf\; display "Reloaded"

set -g base-index 1
setw -g pane-base-index 1

# automatically rename window to current directory
set-option -g status-interval 5
set-option -g automatic-rename on
set-option -g automatic-rename-format '#{b:pane_current_path}'

# Set mouse mode on by default
set -g mouse on
bind-key -N "Enable mouse mode" -n M-m set-option -g mouse on \; display 'Mouse: ON'
bind-key -N "Disable mouse mode" -n M-M set-option -g mouse off \; display 'Mouse: OFF'

bind-key -N "Toggle synchronize panes" a set-window-option synchronize-panes\; display-message "synchronize-panes is now #{?pane_synchronized,on,off}"

# Detach from session
bind -N "Detach from session" d detach

# Help screen: rebind list-keys window into a new pane
bind-key -N "Show searchable help (fzf)" ? split-window -h 'exec tmux list-keys -N | fzf'

# Search
bind -N "Search in pane history" / copy-mode \; command-prompt -i -p "(search down)" "send -X search-backward-incremental \"%%%\""

# move window left or right using , and .
bind-key -N "Move window left" , swap-window -t -1\; select-window -t -1
bind-key -N "Move window right" . swap-window -t +1\; select-window -t +1

# wrap default shell in reattach-to-user-namespace if available
if -b "command -v reattach-to-user-namespace > /dev/null 2>&1" \
    "run 'tmux set -g default-command \"exec $(tmux show -gv default-shell) 2>/dev/null & reattach-to-user-namespace -l $(tmux show -gv default-shell)\"'"

# =====================================
# =========== TMUX COPY ===============
# =====================================

set -g @yank_action 'copy-pipe-and-cancel' #'copy-pipe'

# When scrolling with mouse wheel, reduce number of scrolled rows per tick to "2" (default is 5)
bind -T copy-mode-vi WheelUpPane       select-pane \; send-keys -X -N 2 scroll-up
bind -T copy-mode-vi WheelDownPane     select-pane \; send-keys -X -N 2 scroll-down

# =====================================
# ====== TMUX PLUGIN CONFIG ===========
# =====================================

set -g @pet-new-pane-key 'C-f'
set -g @pet-vertical-split-pane-key 'C-g'

set -g @tmux-gruvbox-right-status-z '#h #{tmux_mode_indicator}'

# =====================================
# ====== PANE HIGHLIGHTING ============
# =====================================

# Bold active border (using gruvbox colors) - preserves transparency
set -g pane-border-style 'fg=#665c54'
set -g pane-active-border-style 'fg=#fabd2f'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run -b '~/.tmux/plugins/tpm/tpm'
